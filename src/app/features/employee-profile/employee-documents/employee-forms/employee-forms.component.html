<form (ngSubmit)="onSubmit()" novalidate>
  <div class="row mb-3">
    <div class="col-md-4">
      <label class="form-label">
        Form / Document Type <span class="text-danger">*</span>
      </label>
     <select class="form-select" required [(ngModel)]="documentTypeId" name="documentTypeId">

      <option value="">Select Document Type</option>
      <option *ngFor="let doc of documentTypes" [value]="doc.id">
        {{ doc.typeName }}
      </option>

    </select>

    </div>

    <div class="col-md-4">
      <label class="form-label">
        Form / Document Name <span class="text-danger">*</span>
      </label>
      <input type="text"
             class="form-control"
             [(ngModel)]="documentName"
             name="documentName"
             required
             maxlength="150"
             placeholder="Enter document name">
      <div *ngIf="showValidation && !documentName" class="text-danger small mt-1">Document name is required.</div>
    </div>

    <div class="col-md-4">
      <label class="form-label">
        Employee Code / ID <span class="text-danger">*</span>
      </label>
      <input type="text"
             class="form-control"
             [(ngModel)]="employeeCode"
             name="employeeCode"
             required
             maxlength="50"
             placeholder="Enter employee code">
      <div *ngIf="showValidation && !employeeCode" class="text-danger small mt-1">Employee code is required.</div>
    </div>
  </div>

  <div class="row mb-3">
    <div class="col-md-4">
      <label class="form-label">
        Issued / Submitted Date <span class="text-danger">*</span>
      </label>
      <input type="date"
             class="form-control"
             [(ngModel)]="issuedDate"
             name="issuedDate"
             required
             (change)="onDateChange()"
             placeholder="Select issued / submitted date">
      <div *ngIf="showValidation && !issuedDate" class="text-danger small mt-1">Issued date is required.</div>
      <div *ngIf="dateError" class="text-danger small mt-1">{{ dateError }}</div>
    </div>

    <div class="col-md-4">
      <label class="form-label">
        Upload File <span class="text-danger">*</span>
      </label>
      <input type="file"
             class="form-control"
             accept=".pdf,.doc,.docx,.jpg,.jpeg,.png"
             (change)="onFileSelect($event)">
      <small class="text-muted">Allowed: PDF, DOC, DOCX, JPG, PNG — Max 5 MB</small>
      <div *ngIf="showValidation && !fileName" class="text-danger small mt-1">File is required.</div>
      <div *ngIf="fileError" class="text-danger small mt-1">{{ fileError }}</div>
    </div>

    <div class="col-md-4">
      <label class="form-label">Remarks / Notes</label>
      <textarea class="form-control" [(ngModel)]="remarks" name="remarks" maxlength="500" placeholder="Additional details..."></textarea>
    </div>
  </div>

  <div class="row mb-3">
    <div class="col-md-4 d-flex align-items-center">
      <div class="form-check mt-2">
        <input class="form-check-input" type="checkbox" [(ngModel)]="confidential" name="confidential" id="confidentialCheck">
        <label class="form-check-label" for="confidentialCheck">Mark as Confidential</label>
      </div>
    </div>

    <div class="col-md-8 text-end">
      <button type="submit" class="btn btn-primary me-2">
        {{ isEdit ? 'Update Form' : 'Upload Form' }}
      </button>
      <button type="button" class="btn btn-secondary" (click)="onReset()">Reset</button>
    </div>
  </div>
</form>

<!-- Search + Table -->
<div class="dashboard-tables full-row mt-4">

  <div class="table-card">
    <h3>Forms List</h3>
    <table class="table table-bordered">
      <thead>
        <tr>
          <th>S.No</th>
          <th (click)="sortBy('type')" style="cursor:pointer">Type
            <span *ngIf="sortColumn==='type'">{{ sortDirection==='asc' ? '▲' : '▼' }}</span>
          </th>
          <th (click)="sortBy('name')" style="cursor:pointer">Name
            <span *ngIf="sortColumn==='name'">{{ sortDirection==='asc' ? '▲' : '▼' }}</span>
          </th>
          <th (click)="sortBy('employee')" style="cursor:pointer">Employee
            <span *ngIf="sortColumn==='employee'">{{ sortDirection==='asc' ? '▲' : '▼' }}</span>
          </th>
          <th (click)="sortBy('date')" style="cursor:pointer">Date
            <span *ngIf="sortColumn==='date'">{{ sortDirection==='asc' ? '▲' : '▼' }}</span>
          </th>
          <th>File</th>
          <th>Actions</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let f of pagedForms(); let i = index">
          <td>{{ (currentPage - 1) * pageSize + i + 1 }}</td>
          <td>{{ f.type }}</td>
          <td>{{ f.name }}</td>
          <td>{{ f.employee }}</td>
          <td>{{ formatDate(f.date) }}</td>

          
            <td>
            <a *ngIf="f.fileName"
              style="cursor:pointer; color:#0d6efd; font-weight:500;"
              (click)="viewDocument(f.fileName)">
              View
            </a>
          </td>
          <td class="action-icons">
            <i class="fa-solid fa-pen me-2" style="color: black;" (click)="editRecord(f)" title="Edit"></i>
            <i class="fa-solid fa-trash" style="color: black;" (click)="deleteRecord(f.id)" title="Delete"></i>
          </td>
        </tr>

        <tr *ngIf="pagedForms().length === 0">
          <td colspan="7" class="text-center">No forms found.</td>
        </tr>
      </tbody>
    </table>

  </div>
</div>

<!-- Pagination Footer -->
<div class="d-flex justify-content-between align-items-center mt-3">
  <div>
    <label>Show:
      <select class="form-select d-inline w-auto ms-2" [(ngModel)]="pageSize" (change)="changePageSize(pageSize)">
        <option *ngFor="let size of pageSizeOptions" [ngValue]="size">{{ size }}</option>
      </select>
      entries
    </label>
  </div>

  <div>
    <button class="btn btn-outline-secondary btn-sm me-2" (click)="changePage(currentPage - 1)" [disabled]="currentPage === 1">Previous</button>

    <span>Page {{ currentPage }} of {{ totalPages }}</span>

    <button class="btn btn-outline-secondary btn-sm ms-2" (click)="changePage(currentPage + 1)" [disabled]="currentPage === totalPages">Next</button>
  </div>
</div>