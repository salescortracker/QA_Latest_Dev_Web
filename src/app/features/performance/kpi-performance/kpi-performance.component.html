<app-header></app-header>
<app-sidebar></app-sidebar>

<div class="dashboard-header">
  <h2 class="dashboard-title">Performance & KPI Review</h2>
  <nav class="breadcrumb">
    <a href="#">Home</a> &gt;
    <a href="#">Performance</a> &gt;
    <span>KPI Submission</span>
  </nav>
</div>

<div class="tab-container">

  <!-- TAB RADIO BUTTONS -->
  <input type="radio" id="tab1" name="tab" checked>
  <input type="radio" id="tab2" name="tab">

  <div class="tab-header">
    <label class="tab-label" for="tab1">Employee Submission</label>
    <label class="tab-label" for="tab2">Manager Review & Approval</label>
  </div>

  <!-- ================= EMPLOYEE SUBMISSION TAB ================= -->
  <div id="content1" class="tab-content">

    <form [formGroup]="reviewForm">

      <!-- Employee Details -->
      <div class="row mb-3">

        <div class="col-md-4">
          <label>Employee Code</label>
          <input type="text" formControlName="employeeCode" class="form-control" readonly>
        </div>

        <div class="col-md-4">
          <label>Employee Name</label>
          <input type="text" formControlName="employeeName" class="form-control" readonly>
        </div>

        <div class="col-md-4">
          <label>Designation</label>
          <input type="text" formControlName="designation" class="form-control" readonly>
        </div>

      </div>

      <div class="row mb-3">

        <div class="col-md-4">
          <label>Department</label>
          <input formControlName="department" class="form-control" readonly>
        </div>

        <div class="col-md-4">
          <label>Reporting Manager</label>
          <input type="text" formControlName="reportingManagerName" class="form-control" readonly>
        </div>

        <div class="col-md-4">
          <label>Performance Cycle</label>
          <select formControlName="performanceCycle" class="form-control">
            <option value="Monthly">Monthly</option>
            <option value="Quarterly">Quarterly</option>
            <option value="Half-Yearly">Half-Yearly</option>
            <option value="Yearly">Yearly</option>
          </select>
        </div>

      </div>

      <div class="row mb-3">

        <div class="col-md-6">
          <label>Project</label>
          <input type="text" formControlName="departmentProject" class="form-control">
        </div>

        <div class="col-md-6">
          <label>Appraisal Year</label>
          <input type="text" formControlName="appraisalYear" class="form-control" readonly>
        </div>

      </div>

      <div class="row mb-3">




        <div class="col-md-4">
          <label>Applicable Start Date</label>
          <input type="date" formControlName="applicableStartDate" class="form-control">
        </div>

        <div class="col-md-4">
          <label>Applicable End Date</label>
          <input type="date" formControlName="applicableEndDate" class="form-control">
        </div>

      </div>

      <div class="mb-3">
        <label>Self Review Summary</label>
        <textarea formControlName="selfReviewSummary" class="form-control" rows="3"></textarea>
      </div>

      <!-- ================= KPI SECTION ================= -->

      <h5 class="mt-4">KPI List</h5>

      <table class="table table-bordered table-striped mt-2">
        <thead class="table-light">
          <tr>
            <th>KPI Name</th>
            <th>Weightage</th>
            <th>Target</th>
            <th>Achieved</th>
            <th>Self Rating</th>
            <th>Remarks</th>
            <th>Action</th>
          </tr>
        </thead>

        <tbody formArrayName="kpis">

          <tr *ngFor="let kpi of kpis.controls; let i=index" [formGroupName]="i">

            <td>
              <input type="text" formControlName="kpiName" class="form-control">
            </td>

            <td>
              <input type="number" formControlName="weightage" class="form-control">
            </td>

            <td>
              <input type="text" formControlName="target" class="form-control">
            </td>

            <td>
              <input type="text" formControlName="achieved" class="form-control">
            </td>

            <td>
              <input type="number" formControlName="selfRating" class="form-control">
            </td>

            <td>
              <input type="text" formControlName="remarks" class="form-control">
            </td>

            <td>
              <button type="button" class="btn btn-danger btn-sm" (click)="removeKpi(i)">
                Remove
              </button>
            </td>

          </tr>

        </tbody>
      </table>

      <button type="button" class="btn btn-info mb-3" (click)="addKpi()">
        + Add KPI
      </button>

      <div class="mt-3">
        <button type="button" class="btn btn-warning me-2" (click)="saveDraft()">
          Save Draft
        </button>

        <button type="button" class="btn btn-success" (click)="submit()">
          Submit
        </button>
      </div>

    </form>

  </div>

  <!-- ================= MANAGER REVIEW TAB ================= -->

  <div id="content2" class="tab-content">

    <h5 class="mt-3">Pending Reviews</h5>

    <div class="row mb-2">
      <div class="col text-end">
        <button class="btn btn-success me-2" (click)="bulkApprove()">
         Bulk Approve Selected
        </button>

        <button class="btn btn-danger" (click)="bulkReject()">
         Bulk Reject Selected
        </button>
      </div>
    </div>



    <table class="table table-striped table-bordered mt-2">

      <thead class="table-light">
        <tr>
          <th>Bulk Actions</th>
          <th>Employee</th>
          <th>Project</th>
          <th>Appraisal Year</th>
          <th>Status</th>
          <th>Action</th>
        </tr>
      </thead>

      <tbody>

        <tr *ngFor="let review of managerReviews">

          <!-- âœ… Checkbox -->
          <td>
            <input type="checkbox" [(ngModel)]="review.isSelected"
              [disabled]="review.status === 'Approved' || review.status === 'Rejected'">
          </td>

          <td>{{review.employeeName}}</td>
          <td>{{review.departmentProject}}</td>
          <td>{{review.appraisalYear}}</td>
          <td>
            <span [ngClass]="{
          'text-success': review.status === 'Approved',
          'text-danger': review.status === 'Rejected',
          'text-warning': review.status === 'Submitted'
      }">
              {{review.status}}
            </span>
          </td>

          <td>
            <!-- Approve -->
            <button class="btn btn-success btn-sm me-2" (click)="approve(review.id)"
              [disabled]="review.status === 'Approved' || review.status === 'Rejected'">
              Approve
            </button>

            <!-- Reject -->
            <button class="btn btn-danger btn-sm me-2" (click)="reject(review.id)"
              [disabled]="review.status === 'Approved' || review.status === 'Rejected'">
              Reject
            </button>

            <!-- Request Button -->
            <button class="btn btn-primary btn-sm" *ngIf="review.status === 'Approved' || review.status === 'Rejected'"
              (click)="requestReview(review.id)">
              Request
            </button>
          </td>

        </tr>

        <tr *ngIf="managerReviews.length === 0">
          <td colspan="6" class="text-center">
            No Records Found
          </td>
        </tr>

      </tbody>



    </table>

  </div>

</div>

<app-footer></app-footer>