<div class="card p-4 shadow-sm">
  <h5 class="mb-3">Leave Approvals (Manager View)</h5>

  <div class="table-responsive">
    <table class="table table-bordered align-middle">
      <thead class="table-dark">
  <tr>
    <th>
      <input type="checkbox" [(ngModel)]="selectAll" (change)="toggleSelectAll()" />
    </th>

    <th (click)="sortBy('employeeName')" style="cursor:pointer">
      Employee Name
      <span *ngIf="sortColumn === 'employeeName'">
        {{ sortDirection === 'asc' ? '▲' : '▼' }}
      </span>
    </th>

    <th (click)="sortBy('leaveType')" style="cursor:pointer">
      Leave Type
      <span *ngIf="sortColumn === 'leaveType'">
        {{ sortDirection === 'asc' ? '▲' : '▼' }}
      </span>
    </th>

    <th (click)="sortBy('from')" style="cursor:pointer">
      From
      <span *ngIf="sortColumn === 'from'">
        {{ sortDirection === 'asc' ? '▲' : '▼' }}
      </span>
    </th>

    <th (click)="sortBy('to')" style="cursor:pointer">
      To
      <span *ngIf="sortColumn === 'to'">
        {{ sortDirection === 'asc' ? '▲' : '▼' }}
      </span>
    </th>

    <th (click)="sortBy('days')" style="cursor:pointer">
      Days
      <span *ngIf="sortColumn === 'days'">
        {{ sortDirection === 'asc' ? '▲' : '▼' }}
      </span>
    </th>

    <th>Reason</th>

    <th (click)="sortBy('status')" style="cursor:pointer">
      Status
      <span *ngIf="sortColumn === 'status'">
        {{ sortDirection === 'asc' ? '▲' : '▼' }}
      </span>
    </th>

    <th>Actions</th>
  </tr>
</thead>


      <tbody>
        <tr *ngFor="let leave of paginatedLeaves(); let i = index">

          <td>
            <input
              *ngIf="leave.status === 'Pending'"
              type="checkbox"
              [(ngModel)]="leave.selected"
              (change)="checkSelectAll()"
            />
          </td>

          <td>{{ leave.employeeName }}</td>
          <td>{{ leave.leaveType }}</td>
          <td>{{ leave.from | date:'dd-MM-yyyy' }}</td>
          <td>{{ leave.to | date:'dd-MM-yyyy' }}</td>
          <td>{{ leave.days }}</td>
          <td>{{ leave.reason }}</td>
          <td>
            <span
              class="badge"
              [ngClass]="{
                'bg-warning text-dark': leave.status === 'Pending',
                'bg-success': leave.status === 'Approved',
                'bg-danger': leave.status === 'Rejected'
              }"
            >
              {{ leave.status }}
            </span>
          </td>
          <td class="text-center">
            <a
              href="#"
              (click)="openViewModal(leave)"
              data-bs-toggle="modal"
              data-bs-target="#viewLeaveModal"
            >
              <i class="fa-solid fa-eye text-primary"></i>
            </a>
          </td>
        </tr>
      </tbody>
    </table>
    <div class="d-flex justify-content-between align-items-center mt-3">
  <div>
    <label>Show:
      <select class="form-select d-inline w-auto ms-2" [(ngModel)]="pageSize" (change)="changePageSize(pageSize)">
        <option *ngFor="let size of pageSizeOptions" [ngValue]="size">{{ size }}</option>
      </select> entries
    </label>
  </div>

  <div>
    <button class="btn btn-outline-secondary btn-sm me-2"
            (click)="changePage(currentPage - 1)"
            [disabled]="currentPage === 1">Previous</button>

    <span>Page {{ currentPage }} of {{ totalPages }}</span>

    <button class="btn btn-outline-secondary btn-sm ms-2"
            (click)="changePage(currentPage + 1)"
            [disabled]="currentPage === totalPages">Next</button>
  </div>
</div>

  </div>

  <div class="mt-3">
    <button class="btn btn-success me-2" (click)="approveSelected()">
      Approve Selected
    </button>
    <button class="btn btn-danger" (click)="rejectSelected()">
      Reject Selected
    </button>
  </div>
</div>

<!-- ✅ View Modal -->
<div
  class="modal fade"
  id="viewLeaveModal"
  tabindex="-1"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Leave Details</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <p><b>Employee:</b> {{ selectedLeave?.employeeName }}</p>
        <p><b>Leave Type:</b> {{ selectedLeave?.leaveType }}</p>
        <p><b>From:</b> {{ selectedLeave?.from | date:'dd-MM-yyyy'}}</p>
        <p><b>To:</b> {{ selectedLeave?.to | date:'dd-MM-yyyy'}}</p>
        <p><b>Days:</b> {{ selectedLeave?.days }}</p>
        <p><b>Reason:</b> {{ selectedLeave?.reason }}</p>
        <p>
          <b>Status:</b>
          <span class="badge bg-secondary">{{ selectedLeave?.status }}</span>
        </p>
      </div>

      <div class="modal-footer" *ngIf="selectedLeave?.status === 'Pending'">
        <button
          class="btn btn-success"
          (click)="approveFromPopup()"
          data-bs-dismiss="modal"
        >
          Approve
        </button>
        <button
          class="btn btn-danger"
          (click)="rejectFromPopup()"
          data-bs-dismiss="modal"
        >
          Reject
        </button>
      </div>

    </div>
  </div>
</div>