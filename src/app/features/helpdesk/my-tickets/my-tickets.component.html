<div class="card">
  <h3 class="section-title">My Tickets</h3>

  <!-- Filter Bar -->
  <form class="filter-container mb-3">
    <div class="row">
      <div class="col-md-3">
        <label class="form-label">Category</label>
        <select class="form-select" [(ngModel)]="model.categoryId" name="categoryId">
          <option value="">Select Category</option>
          <option *ngFor="let c of Category" [value]="c.helpDeskCategoryId">
            {{ c.helpDeskCategoryName }}
          </option>
        </select>
      </div>

      <div class="col-md-3">
        <label class="form-label">Status</label>
        <select class="form-select" [(ngModel)]="model.status" name="status">
          <option value="">All Status</option>
          <option>Open</option>
          <option>Approved</option>
          <option>Rejected</option>
        </select>
      </div>

      <div class="col-md-3">
        <label class="form-label">Date Range</label>
        <input type="date" class="form-control" [(ngModel)]="model.fromDate" name="fromDate">
      </div>

      <div class="col-md-3 d-flex align-items-end">
        <button type="button" class="btn btn-primary w-100" (click)="applyFilter()">
          Filter
        </button>
      </div>
    </div>
  </form>

  <!-- Ticket Table -->
  <div class="table-responsive">
    <table class="table table-bordered table-striped align-middle">
      <thead class="table-light">
        <tr>
          <th>S.No</th>

          <th (click)="sortBy('ticketNumber')" style="cursor:pointer">
            Ticket No
            <span *ngIf="sortColumn === 'ticketNumber'">
              {{ sortDirection === 'asc' ? '▲' : '▼' }}
            </span>
          </th>

          <th (click)="sortBy('categoryName')" style="cursor:pointer">
            Category
            <span *ngIf="sortColumn === 'categoryName'">
              {{ sortDirection === 'asc' ? '▲' : '▼' }}
            </span>
          </th>

          <th (click)="sortBy('subject')" style="cursor:pointer">
            Subject
            <span *ngIf="sortColumn === 'subject'">
              {{ sortDirection === 'asc' ? '▲' : '▼' }}
            </span>
          </th>

          <th (click)="sortBy('priorityName')" style="cursor:pointer">
            Priority
            <span *ngIf="sortColumn === 'priorityName'">
              {{ sortDirection === 'asc' ? '▲' : '▼' }}
            </span>
          </th>

          <th (click)="sortBy('status')" style="cursor:pointer">
            Status
            <span *ngIf="sortColumn === 'status'">
              {{ sortDirection === 'asc' ? '▲' : '▼' }}
            </span>
          </th>

          <th (click)="sortBy('createdAt')" style="cursor:pointer">
            Raised On
            <span *ngIf="sortColumn === 'createdAt'">
              {{ sortDirection === 'asc' ? '▲' : '▼' }}
            </span>
          </th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let t of paginatedTickets(); let i = index">
          <td>{{ (currentPage - 1) * pageSize + i + 1 }}</td>
          <td>{{ t.ticketNumber }}</td>
          <td>{{ t.categoryName }}</td>
          <td>{{ t.subject }}</td>
          <td>{{ t.priorityName }}</td>
          <td>
            <span class="badge"
              [ngClass]="{
                'bg-warning text-dark': t.status === 'Open',
                'bg-success': t.status === 'Approved',
                'bg-danger': t.status === 'Rejected'
              }">
              {{ t.status }}
            </span>
          </td>
          <td>{{ t.createdAt | date:'dd-MMM-yyyy' }}</td>
        </tr>
      </tbody>
    </table>

    <!-- Pagination Controls -->
    <div class="d-flex justify-content-between align-items-center mt-3">
      <div>
        <label>Show:
          <select class="form-select d-inline w-auto ms-2"
                  [(ngModel)]="pageSize"
                  (change)="changePageSize(pageSize)">
            <option *ngFor="let size of pageSizeOptions" [ngValue]="size">
              {{ size }}
            </option>
          </select>
          entries
        </label>
      </div>

      <div>
        <button class="btn btn-outline-secondary btn-sm me-2"
                (click)="changePage(currentPage - 1)"
                [disabled]="currentPage === 1">
          Previous
        </button>

        <span>Page {{ currentPage }} of {{ totalPages }}</span>

        <button class="btn btn-outline-secondary btn-sm ms-2"
                (click)="changePage(currentPage + 1)"
                [disabled]="currentPage === totalPages">
          Next
        </button>
      </div>
    </div>
  </div>
</div>
