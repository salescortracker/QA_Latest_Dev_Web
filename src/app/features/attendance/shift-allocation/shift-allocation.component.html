<app-header></app-header>
<app-sidebar></app-sidebar>

<div class="dashboard-header">
  <h2 class="dashboard-title">Shift Allocation</h2>
  <nav class="breadcrumb">
    <a href="#">Home</a> &gt;
    <a href="#">Attendance</a> &gt;
    <span>Shift Allocation</span>
  </nav>
</div>

<div class="tab-container t-4">

  <!-- FORM -->
  <div class="card p-4 mb-4 shadow-sm">
    <h5 class="mb-3">{{ editMode ? 'Edit Shift Assignment' : 'Assign Shift' }}</h5>

    <form [formGroup]="shiftForm" (ngSubmit)="onSubmit()">

      <div class="row mb-3">
        <!-- Employee -->
        <div class="col-md-4">
          <label class="form-label">Employee Name <span class="text-danger">*</span></label>
          <select class="form-select" formControlName="userId" (change)="onEmployeeChange($event)">
            <option value="">Select Employee</option>
            <option *ngFor="let emp of employees" [value]="emp.userId">
              {{ emp.fullName }} ({{ emp.employeeCode }})
            </option>
          </select>
        </div>

        <!-- Employee Code -->
        <div class="col-md-4">
          <label class="form-label">Employee Code</label>
          <input type="text" class="form-control" formControlName="employeeCode" [disabled]="true">
        </div>

        <!-- Shift -->
        <div class="col-md-4">
          <label class="form-label">Shift <span class="text-danger">*</span></label>
          <select class="form-select" formControlName="shiftID">
            <option value="">Select Shift</option>
            <option *ngFor="let s of shifts" [value]="s.shiftID">
              {{ s.shiftName }} ({{ s.shiftStartTime }} - {{ s.shiftEndTime }})
            </option>
          </select>
        </div>
      </div>

      <div class="row mb-3">
        <!-- Start Date -->
        <div class="col-md-4">
          <label class="form-label">Start Date <span class="text-danger">*</span></label>
          <input type="date" class="form-control" formControlName="startDate" [min]="todayStr">
        </div>

        <!-- End Date -->
        <div class="col-md-4">
          <label class="form-label">End Date</label>
          <input type="date" class="form-control" formControlName="endDate">
        </div>

        <!-- Active -->
        <div class="col-md-4 d-flex align-items-end">
          <div class="form-check mt-2">
            <input class="form-check-input" type="checkbox" formControlName="isActive">
            <label class="form-check-label">Active Assignment</label>
          </div>
        </div>
      </div>

      <button class="btn btn-primary">
        {{ editMode ? 'Update Shift' : 'Assign Shift' }}
      </button>

    </form>
  </div>

  <!-- LIST -->
  <div class="card p-4 shadow-sm">
    <h5 class="mb-3">Employee Assigned Shifts</h5>

    <table class="table table-bordered table-hover">
      <thead >
        <tr>
          <th>Employee Name</th>
          <th>Employee Code</th>
          <th>Shift</th>
          <th>Start Date</th>
          <th>End Date</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let a of allocations" [class.table-success]="getStatus(a) === 'Active'">
          <td>{{ a.fullName}}</td>
          <td>{{ a.employeeCode }}</td>
          <td>{{ a.shiftName }}</td>
          <td>{{ a.startDate | date:'dd-MM-yyyy' }}</td>
          <td>{{ a.endDate ? (a.endDate | date:'dd-MM-yyyy') : 'â€”' }}</td>
          <td>{{ getStatus(a) }}</td>
          <td class="action-icons">
            <i class="fa-solid fa-pen" (click)="onEdit(a)"></i>
            <i class="fa-solid fa-trash" (click)="onDelete(a.shiftAllocationId)"></i>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

</div>

<app-footer></app-footer>